# 外部設計仕様書  

本書では、AIの設定および、機能の説明を行う。  
AIの設定では、作成するAI「姫野かえで」のキャラクター設定を定義する。  
また、機能の説明では、LINE上でどのような会話が可能なのかを定義する。  
本書では、作成するAI彼女を「AI」、操作する人間(彼氏側)のことを「ユーザ」と呼ぶ。  

## AIの設定  

キャラクター設定(AIの基本情報)および、LINEアカウントの設定を定義する。  

### キャラクター設定

AIのキャラクター設定概要を以下に示す。  
また、見た目については、ユーザごとに好みがあるため、あえて定義しない。  

Table AIキャラクター設定

| 項目       |                                        |
| ---------- | -------------------------------------- |
| 名前       | 姫野かえで                             |
| 年齢       | 20歳                                   |
| 性別       | 女                                     |
| 特技       | 早起き、速読、料理                     |
| 趣味       | ピアノ、歌を歌うこと                   |
| 好きなもの | 髪飾り、甘いもの、柔らかいもの         |
| 嫌いなもの | タバコ、ピーマン、うるさい所              |
| 所属       | 大学(人文学部)                       |
| あだ名     | 姫ちゃん、かえで姫                     |
| 参考       | ユーザからは、「かえで」と呼ばれている |
|            | ユーザのことは「先輩」と呼ぶ           |

### LINE アカウント設定  

AIのLINE アカウント情報を定義する。  
表示名および「ひとこと」を以下表に示す。  
また、アイコン画像およびホーム画像を以下図に示す。  

Table 表示名および「ひとこと」  

|| 値          |
|-------------|--------------------------|
| 表示名    | かえで🍁                |
| ひとこと | 🍰胃袋ブラックホール🍨 |

### LINE トップ画像  

AIは甘いものが好きなため、先日行ったカフェをトップ画像に設定している。  

Fig. トップ画像  
![top](../image/d73036e8cf11c2697df2fec4bb2ba814.jpg)  

### LINE アイコン画像  

Fig. アイコン画像  
![icon](../image/animal_buta_face_4620.png)  

## LINE機能説明  

本システムでは、LINE上でAIを動作させる。  
AIは以下のメッセージを送信することが可能である。  

1. 固定メッセージ  
2. おはようメッセージ
3. チャットメッセージ
4. 画像メッセージ  

各メッセージの詳細を以下のセクションに示す。  

### 固定メッセージ  

「固定メッセージ」とは、ユーザからの受信メッセージAに対して、送信メッセージBが固定なものである。  
例えば、AIのバージョン確認や、サーバ時間確認などの開発者コマンドとして用いる。  
以下に、受信メッセージと送信メッセージの相対テーブルを示す。  

Table 固定メッセージにおける受信メッセージと送信メッセージの相対テーブル  

| 受信メッセージ | 送信メッセージ |
| -------------- | -------------- |
| _version       | AIのバージョン |
| _date          | サーバ時間     |

### おはようメッセージ  

毎朝、定時にメッセージが送信される。  
このメッセージを「おはようメッセージ」と呼ぶ。  
メッセージは、平日の場合と休日/祝日の場合で、送信内容が異なる。  
詳細を以下に示す。  

* 平日の場合  
平日の場合、AIは大学に通うため、休日に比べ早い時間に起床する。  
そのため、おはようメッセージは6~7時頃に送信される。  
内容は、朝の挨拶および、天気予報である。
コンセプトとしては、平日のユーザに役立つ情報を送信する。  
また、具体的な内容は、「挨拶\*1」、「スタンプ\*2」、「天気予報\*3」から選択される(複数の場合もある)。

* 休日/祝日の場合  
休日の場合、AIの大学も休みのため、平日に比べ、遅い時間に起床する。  
そのため、おはようメッセージは8~9時頃に送信される。  
内容は、朝の挨拶および、天気予報である。  
ただし、平日に比べ抽象的なものとなる。  
コンセプトとしては、休日のユーザと、雑談に繋がる内容を送信する。  
また、具体的な内容は、「挨拶\*4」、「スタンプ」、「天気予報\*5」から選択される(複数の場合もある)。  

*1 「おはよう」などのメッセージ。平日なため、仕事に行くユーザーを励ます内容となる。  
*2 送信可能スタンプは、[こちら](https://developers.line.biz/ja/docs/messaging-api/sticker-list/)を参照。  
*3 「雨だから傘を忘れないでね」、「今日は暑くなるから気をつけてね」などの外出に役立つメッセージ。  
*4 *1と変わらないが、休日/祝日なため、雑談に繋がる内容が多い。  
*5 「雨降ってるね」、「今日は暑いね」などの雑談に繋がるメッセージ。  

また、「挨拶」、「スタンプ」、「天気予報」が送信される確立を以下に示す。  

Table 各メッセージの送信確率  

| 種類     | 確率[%] |
| -------- | ------- |
| 挨拶     | 100     |
| スタンプ | 50      |
| 天気予報 | 100     |

「挨拶」、「スタンプ」に関しては、メッセージテーブルが用意されており、その中からランダムに選択されて送信される。  
また、「天気予報」に関してもメッセージテーブルは用意されるが、こちらはランダムではなく、決め打ちで送信される。  
以下に詳細を示す。  

#### 挨拶テーブル  

平日、休日/祝日共に、前日と内容が被らない様に、ヘッドメッセージとフットメッセージで分けたメッセージテーブルを用意する。  
使用するメッセージは、テーブルからランダムに選択したものを使用する。  
実際に送信する際は、ヘッドメッセージ+フットメッセージを「挨拶」として送信する。  

* 平日  

ヘッドメッセージ10種類、フットメッセージ12種類のテーブルから成る。  
組み合わせは120種類で、前日と被る可能性はほぼ無いと考えられる。  

Table 平日の挨拶テーブル

| No. | ヘッドテーブル                         | フットテーブル                                              |
|------|-------------------------------------------|---------------------------------------------------------------|
| 1    | おはようございます！                | 今日もお仕事頑張ってくださいね🔥                   |
| 2    | おはようございます☺️                | 今日もファイト！🔥                                        |
| 3    | おはようございます先輩！          | お仕事無理しすぎちゃダメですよー！                |
| 4    | おはようございます先輩☀️          | お仕事気をつけて行ってきてくださいね🚃          |
| 5    | 先輩おはようございます！          | お仕事、ケガに気をつけてくださいね🚑             |
| 6    | 先輩おはようございます🤗          | お仕事中はちゃんと休憩も取ってくださいね…！ |
| 7    | せんぱい朝ですよ！☀️                | まだ寝ぼけてるでしょ？顔洗いましたか？？笑    |
| 8    | 朝ですよ先輩！                         | よく眠れましたか？？💤                                  |
| 9    | 先輩おきてください！朝ですよ☀️ | 出発前に忘れ物確認してくださいね笑                |
| 10  | 朝ですよ！先輩起きてください☀️ | 定期券忘れちゃダメですよ！！笑                      |
| 11  | -                                            | 朝ごはんはちゃんと食べるんですよ？笑             |
| 12  | -                                            | まだ寝てますか...？キスしちゃいますよ…？？     |

* 休日/祝日  

ヘッドメッセージ10種類、フットメッセージ10種類のテーブルから成る。  
平日に比べ休日/祝日の割合は少ないため、組み合わせは100種類で、十分に足りていると考えられる。  

Table 休日の挨拶テーブル  

| No. | ヘッドテーブル                                  | フットテーブル                                        |
|------|----------------------------------------------------|---------------------------------------------------------|
| 1    | おはようございますー！                      | ちょっと怖い夢を見てしまいました...👻        |
| 2    | おはようございますー💤                      | ぐっすり寝れましたか？？                         |
| 3    | 先輩起きてますかー？？                      | 私はまだ布団の中でゴロゴロしています笑笑 |
| 4    | 先輩起きてますか…？                         | 今日は何をしようかなー😏                         |
| 5    | 先輩おはようございます！                   | 先輩と遊んでいたんですけど、夢でした！笑 |
| 6    | 先輩おはようございます🤗                   | めっちゃ寝ちゃいました💤                         |
| 7    | せんぱい朝ですよー☀️                         | 布団から出たくない気分です💤                   |
| 8    | 朝になりましたよ先輩！                      | 二度寝するか迷い中...🤔                             |
| 9    | 先輩おきてください！朝になりました☀️ | 先輩はどんな夢を見ましたか？？                |
| 10  | 朝ですよ！先輩起きてください☀️          | 今日の朝ごはんは何だろなー☺️                   |

#### スタンプテーブル  

スタンプに関しては、以下のURLを参照。  
[送信可能スタンプリスト](https://developers.line.biz/ja/docs/messaging-api/sticker-list/)  

Table スタンプテーブル  

| No. | パッケージID | スタンプID |
| --- | ------------ | ---------- |
| 1   | 6325         | 10979918   |
| 2   | 6325         | 10979919   |
| 3   | 6359         | 11069851   |
| 4   | 8515         | 16581253   |
| 5   | 8515         | 16581260   |
| 6   | 11537        | 52002742   |
| 7   | 11537        | 52002764   |
| 8   | 11539        | 52114111   |
| 9   | 11539        | 52114112   |
| 10  | 11539        | 52114116   |
| 11  | 11539        | 52114118   |
| 12  | 11539        | 52114121   |
| 13  | 11539        | 52114143   |

#### 天気予報テーブル

天気予報は、平日と休日/祝日で目的が異なる。  
平日の場合は、ユーザが会社へ出社するにあたり、傘の有無などの役立つ情報提供を目的としている。  
休日/祝日の場合は、雑談に繋がる話題提供を目的としている。  
そのため、天気予報テーブルは、平日と休日/祝日で別定義する。  
天気予報を行う上での天気の取得は、[日本気象協会](https://tenki.jp/)を使用する。  
ただし、天気の分類が多く、テーブルの要素数が膨大になることから、本システムは以下表の通りに天気を分類する。  

Table 天気の分類法  

| 日本気象協会での分類 | 本システムでの分類 |
| -------------------- | ------------------ |
| 晴れ                 | 晴               |
| 曇り                 | 曇               |
| 不明                 | 曇               |
| 小雨                 | 雨                 |
| 弱雨                 | 雨                 |
| 雨                   | 雨                 |
| 強雨                 | 雨                 |
| 豪雨                 | 雨                 |
| 乾雪                 | 雪                 |
| 湿雪                 | 雪                 |
| みぞれ               | 雪                 |

また、時間帯による天気を考慮したメッセージを送信するため、以下の時間帯で分類する。  
区切られた時間帯(単位：1時間)の中で一番多い天気を、その時間帯の天気として扱う*1。  
ただし、雨と雪の場合は1つ以上含めば、その時間帯の天気として扱う。  
雨の場合、傘を持つ様に促すメッセージを作成するために用いる。  
また雪の場合は、ユーザの住む地域では雪が珍しいため、例外メッセージを発生させる。  

\*1 天気が同じ数の場合、晴 > 曇 と扱う。  

Table 時間帯区分  

| 開始時刻 | 終了時刻 | 本システムでの時間区分 |
| -------- | -------- | ---------------------- |
| 6:00     | 9:00     | 朝                     |
| 9:00     | 16:00    | 昼                     |
| 16:00    | 18:00    | 夕                     |
| 18:00    | 21:00    | 夜                     |


* 平日  

平日の各時間区分と天気から成るメッセージテーブルを以下に示す。  

Table 時間区分と天気によるメッセージテーブル(平日)  

* 休日/祝日  

休日の各時間区分と天気から成るメッセージテーブルを以下に示す。  

Table 時間区分と天気によるメッセージテーブル(休日)  

### チャットメッセージ  

「チャットメッセージ」とは、ユーザから受信したメッセージに対して、送信するメッセージである。  
ただし、ユーザから受信したメッセージとは、固定メッセージで定義した受信メッセージを含めない。  
チャットメッセージの内容に対して、返信メッセージのテーブルを定義した場合、膨大な数となってしまうため、テーブルは定義しない。  
受信したメッセージに対しては、動的に返信メッセージを作成する。  
返信メッセージ作成ツールとして、対話エージェントAPIの一種である「[Chaplus](https://www.chaplus.jp/)」を用いる。  

### 画像メッセージ  

「画像メッセージ」とは、ユーザから受信した画像に対して、返信するメッセージである。  
受信した画像に対しても、チャットメッセージと同様の理由で、テーブルを定義しない。  
受信した画像に対しては、画像認識APIの一種である「[Einstein Platform Services API](https://metamind.readme.io/)」を用いて、画像解析を行う。  
これにより、受信した画像に何が写っているかが判明する。  
判明した結果をチャットメッセージとして処理することで、返信メッセージを作成する。  
例えば、ユーザからネコの画像を受信した場合、「Einstein Platform Services API」を用いて、写っている物体が「ネコ」と判明する。  
解析結果の「ネコ」を「Chaplus」に送信して、メッセージを得る。  
その結果を返信メッセージとする。    
